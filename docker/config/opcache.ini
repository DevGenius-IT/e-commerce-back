; Configuration OPcache pour les microservices e-commerce
; Optimis√©e pour Laravel et hautes performances

[opcache]
; Enable OPcache
opcache.enable = 1
opcache.enable_cli = 1

; Memory settings
opcache.memory_consumption = 256
opcache.interned_strings_buffer = 16
opcache.max_accelerated_files = 20000

; Performance settings
opcache.revalidate_freq = 0
opcache.validate_timestamps = 1
opcache.fast_shutdown = 1
opcache.save_comments = 1
opcache.enable_file_override = 1

; Error settings
opcache.log_verbosity_level = 2
opcache.error_log = /var/log/opcache.log

; Security
opcache.restrict_api = ""
opcache.blacklist_filename = ""

; JIT compilation (PHP 8.0+)
opcache.jit_buffer_size = 128M
opcache.jit = tracing

; File cache (fallback)
opcache.file_cache = /tmp/opcache
opcache.file_cache_only = 0
opcache.file_cache_consistency_checks = 1

; Optimization
opcache.optimization_level = 0x7FFEBFFF
opcache.inherited_hack = 1
opcache.dups_fix = 0

; Preloading (Laravel optimization)
; opcache.preload = /var/www/services/[service-name]/preload.php
; opcache.preload_user = www-data

; Protection against cache corruption
opcache.protect_memory = 1

; Max file size to cache
opcache.max_file_size = 0

; Force restart conditions
opcache.force_restart_timeout = 180
opcache.max_wasted_percentage = 10

; Huge pages support (Linux)
opcache.huge_code_pages = 1